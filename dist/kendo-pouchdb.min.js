/* kendo-pouchdb v0.0.1 18-04-2015 (C) 2015 Terikon Software */

!function(a,b){b(["PouchDB","pouchCollate"],a)}(function(a,b){if(!a)throw new Error('Please include "pouchdb.js" before kendo-pouchdb');if(!b)throw new Error('Please include "pouchdb-collate.js" before kendo-pouchdb');return function(c){var d=kendo.data.RemoteTransport.extend({init:function(b){var c=b&&b.pouchdb?b.pouchdb:{},d=c.db,e=c.idFactory;if(!d)throw new Error('The "db" option must be set.');if(!(d instanceof a))throw new Error('The "db" option must be a PouchDB object.');if(this.db=d,!e)throw new Error('The "idFactory" option must be set.');this.idFactory="function"==typeof e?e:function(a){return a[e]},kendo.data.RemoteTransport.fn.init.call(this,b)},push:function(a){this.db.changes({since:"now",live:!0,include_docs:!0}).on("change",function(b){b.deleted?a.pushDestroy(b.doc):a.pushCreate(b.doc)}).on("error",function(a){})},read:function(a){this.db.allDocs({include_docs:!0}).then(function(b){var d=c.map(b.rows,function(a){return a.doc});a.success(d)})["catch"](a.error)},_crud:function(a,b,c,d){d.call(this,b).then(function(a){b._rev=a.rev,c.success(b)})["catch"](function(b){409===b.status&&console.log(kendo.format("kendo-pouchdb: conflict occured for {0}: {1}",a,b)),c.error(b)})},create:function(a){var c=a.data;c._id=b.toIndexableString(this.idFactory(c)),this._crud("create",c,a,function(a){return this.db.put(a)})},update:function(a){var b=a.data;this._crud("update",b,a,function(a){return this.db.put(a)})},destroy:function(a){var b=a.data;this._crud("destroy",b,a,function(a){return this.db.remove(a)})}});c.extend(!0,kendo.data,{transports:{pouchdb:d}});var e=kendo.data.DataSource.extend({init:function(a){if(a&&a.type&&"pouchdb"===a.type){var b;if(this._ispouchdb=!0,a.schema&&a.schema.model&&a.schema.model.fn&&a.schema.model.fn instanceof kendo.data.Model){if(b=a.schema.model,"_id"!==b.idField)throw new Error('The Model\'s id option should be "_id"')}else if(a=c.extend(!0,{schema:{model:{id:"_id"}}},a),"_id"!==a.schema.model.id)throw new Error('The model.id option should not be provided or should be "_id"');a.serverPaging=void 0===a.serverPaging?!0:a.serverPaging,a.serverFiltering=void 0===a.serverFiltering?!0:a.serverFiltering,a.serverSorting=void 0===a.serverSorting?!0:a.serverSorting,a.serverGrouping=void 0===a.serverGrouping?!0:a.serverGrouping,a.serverAggregates=void 0===a.serverAggregates?!0:a.serverAggregates}kendo.data.DataSource.fn.init.apply(this,arguments)},pushCreate:function(a){var b,c;return this._ispouchdb?(b=a[0],c=this.get(b._id),void 0!==c?b._rev!==c._rev?kendo.data.DataSource.fn.pushUpdate.apply(this,arguments):void 0:kendo.data.DataSource.fn.pushCreate.apply(this,arguments)):kendo.data.DataSource.fn.pushCreate.apply(this,arguments)},getByModelId:function(a){return this._ispouchdb?kendo.data.DataSource.fn.get.call(this,b.toIndexableString(a)):kendo.data.DataSource.fn.get.apply(this,arguments)}});e.create=kendo.data.DataSource.create,kendo.data.PouchableDataSource=e}(window.kendo.jQuery),window.kendo},"function"==typeof define&&define.amd?define:function(a,b){b(window.PouchDB,window.pouchCollate)});
//# sourceMappingURL=kendo-pouchdb.min.js.map